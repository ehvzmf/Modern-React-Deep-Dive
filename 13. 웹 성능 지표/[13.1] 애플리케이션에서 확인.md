# create-react-app

### `reportWebVitals()`

: ì›¹ì—ì„œ ì„±ëŠ¥ì„ ì¸¡ì •í•˜ê¸° ìœ„í•œ í•¨ìˆ˜

```jsx
// reportWebVitals.ts
import { ReportHandler } from 'web-vitals

const reportWebVitals = (onPerfEntry?: ReportHandler) => {
	if (onPerfEntry && onPerfEntry instanceof Function) {
		import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
			getCLS(onPerfEntry)
			getFID(onPerfEntry)
			getFCP(onPerfEntry)
			getLCP(onPerfEntry)
			getTTFB(onPerfEntry)
		})
	}
}

export default reportWebVitals

// index.tsx
reportWebVitals()
```

1. ëˆ„ì  ë ˆì´ì•„ì›ƒ ì´ë™(CLS)
2. ìµœì´ˆ ì…ë ¥ ì§€ì—°(FID)
3. ìµœì´ˆ ì½˜í…ì¸ í’€ í˜ì¸íŠ¸(FCP)
4. ìµœëŒ€ ì½˜í…ì¸  í˜ì¸íŒ…(LCP)
5. ì²« ë°”ì´íŠ¸ê¹Œì§€ì˜ ì‹œê°„(TTFB)

<aside>
ğŸ‘¾

`PerformanceObserver` API ë•ë¶„ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¸Œë¼ìš°ì € ì›¹í˜ì´ì§€ ì„±ëŠ¥ ì¸¡ì •ì´ ê°€ëŠ¥í•˜ë‹¤. 
â†’ ì´ APIë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ëŠ” `web-vitals`ì˜ ë„ì›€ìœ¼ë¡œ ì„±ëŠ¥ ì¸¡ì •ì´ ì–´ë µë‹¤. 

</aside>

<aside>
ğŸ‘¾

`ReportHandler`: ë‹¨ìˆœíˆ ì„±ëŠ¥ ê°ì²´ì¸ `Metric`ì„ ì¸ìˆ˜ë¡œ ë°›ëŠ” í•¨ìˆ˜ íƒ€ì…
- `Metric`ì„ ì›í•˜ëŠ” ëŒ€ë¡œ ë‹¤ë£° ìˆ˜ ìˆë‹¤. 
- ì½˜ì†”ì— ë‹¨ìˆœ ì¶œë ¥, ì„œë²„ ì „ì†¡ ë“±ì˜ ì‘ì—…

</aside>

```jsx
reportWebVitals(console.log)

/*
{
	"name": "FCP",
	"value": "125.30000001192093",
	"delta": "125.30000001192093",
	"entries": [ ... ],
	"id": "v2-1670337101650-1529230012687"
}
. . .
*/
```

- ë‹¨ìˆœíˆ `console.log`ë¡œ ê¸°ë¡í•œë‹¤ë©´ ë¸Œë¼ìš°ì € ì½˜ì†” ì°½ì— ê¸°ë¡í•˜ëŠ” ìš©ë„ë¡œë§Œ í™œìš©
- ì‹¤ì œë¡œ ì„œë²„ ë“± ì–´ë”˜ê°€ì— ê¸°ë¡í•˜ê³  ì‹¶ë‹¤ë©´
    - ì†ŒëŸ‰ì˜ ë¶„ì„ìš© ë°ì´í„° ì „ì†¡ì„ ìœ„í•œ `sendBeacon` API
    - `fetch` ë“±ì˜ APIë¥¼ ì‚¬ìš©í•´ ì„œë²„ ë˜ëŠ” êµ¬ê¸€ ì• ë„ë¦¬í‹±ìŠ¤ë¡œ ì „ì†¡
    
    ```jsx
    function sendToAnalytics(metric: ReportHandler) {
    	const body = JSON.stringify(metric)
    	const url = '/api/analytics' // ì§€í‘œ ì •ë³´ë¥¼ ë³´ë‚¼ ìœ„ì¹˜
    	
    	// sendBeaconì´ ì—†ë‹¤ë©´ fetchë¥¼ ì‚¬ìš©í•´ ë³´ë‚¸ë‹¤. 
    	if (navigator.sendBeacon) {
    		navigator.sendBeacon(url, body)
    	} else {
    		fetch(url, { body, method: 'POST', keepalive: true })
    	}
    }
    
    reportWebVitals(sendToAnalytics)
    function sendToAnalytics({ id, name, value }: ReportHandler) {
    	ga('send', 'event', {
    		eventCategory: 'Web Vitals', 
    		eventAction: name, 
    		eventValue: Math.round(name === 'CLS' ? value * 1000 : value), 
    		eventLabel: id, 
    		nonInteraction: true,
    	})
    }
    
    reportWebVitals(sendToAnalytics)
    ```
    

# create-next-app

### `NextWebVitalsMetric`

ê¸°ë³¸ ì œê³µ ë©”ì„œë“œ, ìœ„ì™€ ë¹„ìŠ·í•˜ê²Œ ì¸¡ì • ê°€ëŠ¥

```jsx
// _app í˜ì´ì§€ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•´ ì‚¬ìš©
import { AppProps, NextWebVitalsMetric } from 'next/app'

/*
export declare type NextWebVitalsMetric = {
	id: string;
	startTime: number;
	value: number;
} & {{
	label: 'web-vital';
	name: 'FCP' | 'LCP' | 'CLS' | 'FID' | 'TTFB' | 'INP';
} | {
	label: 'custom';
	name: 'Next.js-hydration' | 'Next.js-route-change-to-render' | 'Next.js-render';
})
*/
export function reportWebVitals(metric: NextWebVitalsMetric) {
	console.log(metric)
}

function MyApp({ Component, pageProps }: AppProps) {
	return <Component {...pageProps} />
}

export default MyApp
```

- Next.js íŠ¹í™” ì‚¬ìš©ì ì§€í‘œ ì œê³µ
    - `Next.js-hydration`: í˜ì´ì§€ê°€ ì„œë²„ ì‚¬ì´ë“œì—ì„œ ë Œë”ë§ë˜ì–´ í•˜ì´ë“œë ˆì´ì…˜í•˜ëŠ” ë° ê±¸ë¦° ì‹œê°„
    - `Next.js-route-change-to-render`: í˜ì´ì§€ê°€ ê²½ë¡œ ë³€ê²½ í›„ í˜ì´ì§€ ë Œë”ë§ ì‹œì‘ì— ê±¸ë¦¬ëŠ” ì‹œê°„
    - `Next.js-render`: ê²½ë¡œ ë³€ê²½ ì™„ë£Œ í›„ í˜ì´ì§€ë¥¼ ë Œë”ë§í•˜ëŠ” ë° ê±¸ë¦° ì‹œê°„
- ìµœì´ˆ í˜ì´ì§€ ì§„ì… ì‹œ
    - Next.jsëŠ” ìµœì´ˆì— ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§ ìˆ˜í–‰, í•„ì—°ì ìœ¼ë¡œ ë¦¬ì•¡íŠ¸ì˜ í•˜ì´ë“œë ˆì´ì…˜ ì‘ì—…
- ë¼ìš°íŒ… ì‹œ ë¡œê·¸ ì œê³µ
    - ì´í›„ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë¼ìš°íŒ…ì´ ì¼ì–´ë‚˜ëŠ” í•œ ë²ˆê°ˆì•„ ë‚˜íƒ€ë‚¨
    - ê°ê° í˜ì´ì§€ ì „í™˜ê³¼ ì „í™˜ì— ë”°ë¥¸ ë Œë”ë§ì— ê±¸ë¦° ì‹œê°„ì„ ì•Œë ¤ì¤€ë‹¤.
- ëª¨ë“  ì‹œê°„ ë‹¨ìœ„ëŠ” ms
- ê¸°ì¤€ì€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë‚˜, SSRì— ì˜¤ë˜ ê±¸ë¦¬ì§„ ì•ŠëŠ”ì§€, í˜ì´ì§€ ì „í™˜ ì‹œ í˜¸ì¶œë˜ëŠ” `getServerSideProps`ê°€ ì˜¤ë˜ ê±¸ë¦¬ì§€ ì•ŠëŠ”ì§€ ì²´í¬
